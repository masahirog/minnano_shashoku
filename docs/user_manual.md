# みんなの社食 オペレーション管理システム 操作マニュアル

**バージョン:** 2.0
**最終更新日:** 2025-12-05

---

## 目次

1. [ログイン](#ログイン)
2. [定期スケジュール管理](#定期スケジュール管理)
3. [案件管理](#案件管理)
4. [カレンダー表示](#カレンダー表示)
5. [スケジュール調整](#スケジュール調整)
6. [配送シート出力](#配送シート出力)
7. [請求書管理](#請求書管理)
8. [入金管理](#入金管理)
9. [在庫管理](#在庫管理)
10. [マスタデータ管理](#マスタデータ管理)
11. [トラブルシューティング](#トラブルシューティング)

---

## ログイン

### アクセス方法

1. ブラウザで管理画面にアクセス
   - URL: `http://localhost:3000/admin`（開発環境）
   - URL: `https://your-production-url.com/admin`（本番環境）

2. ログイン情報を入力
   - メールアドレス
   - パスワード

3. 「ログイン」ボタンをクリック

### パスワードを忘れた場合

1. ログイン画面の「パスワードを忘れた方」をクリック
2. 登録メールアドレスを入力
3. 送信されたメールのリンクから新しいパスワードを設定

---

## 定期スケジュール管理

### 定期スケジュールとは

毎週・隔週などで繰り返し発生する案件を事前に登録しておくことで、自動的に案件を生成できる機能です。

### 定期スケジュールの登録

1. サイドバーから「Recurring orders」をクリック
2. 「新規作成」ボタンをクリック
3. 必要な情報を入力
   - **企業**: 配送先企業を選択
   - **飲食店**: 配送元飲食店を選択
   - **メニュー**: 提供するメニューを選択
   - **曜日**: 配送する曜日（例：monday, tuesday）
   - **頻度**: weekly（毎週）またはbiweekly（隔週）
   - **食数**: デフォルトの食数
   - **開始日**: 定期スケジュールの開始日
   - **終了日**: 定期スケジュールの終了日
   - **配送会社**（任意）
   - **回収時刻**（任意）
4. 「作成する」ボタンをクリック

### 案件の自動生成

1. サイドバーから「Recurring orders」をクリック
2. 「案件を自動生成」ボタンをクリック
3. 期間を指定（例：4週間分）
4. 「生成する」ボタンをクリック
5. 確認メッセージが表示されたら完了

**注意事項:**
- 既に生成済みの案件は重複して作成されません
- 飲食店の定休日には自動的に案件は生成されません
- キャパシティオーバーになる場合はエラーメッセージが表示されます

### 定期スケジュールの編集

1. サイドバーから「Recurring orders」をクリック
2. 編集したい定期スケジュールの「編集」リンクをクリック
3. 情報を修正
4. 「更新する」ボタンをクリック

### 定期スケジュールの削除

1. サイドバーから「Recurring orders」をクリック
2. 削除したい定期スケジュールの「削除」リンクをクリック
3. 確認ダイアログで「OK」をクリック

**注意:** 定期スケジュールを削除しても、既に生成された案件は削除されません。

---

## 案件管理

### 案件一覧の表示

1. サイドバーから「Orders」をクリック
2. 案件一覧が表示されます

### 案件の検索・フィルタリング

1. 一覧画面上部の検索ボックスを使用
2. フィルター条件を指定
   - 企業
   - 飲食店
   - ステータス
   - 日付範囲
3. 「検索」ボタンをクリック

### 案件の新規作成

1. 「新規作成」ボタンをクリック
2. 必要な情報を入力
   - 企業
   - 飲食店
   - メニュー
   - 予定日
   - 食数
   - ステータス（pending, confirmed, completed, cancelled）
   - 回収時刻
   - 倉庫集荷時刻
   - 返却先
   - 器材メモ
   - 試食会フラグ
3. 「作成する」ボタンをクリック

**バリデーション:**
- 飲食店のキャパシティを超える場合はエラーになります
- 定休日の場合はエラーになります
- 倉庫集荷時刻と回収時刻の間隔が30分未満の場合はエラーになります

### 案件の編集

1. 編集したい案件の「編集」リンクをクリック
2. 情報を修正
3. 「更新する」ボタンをクリック

### 案件の削除

1. 削除したい案件の「削除」リンクをクリック
2. 確認ダイアログで「OK」をクリック

---

## カレンダー表示

### カレンダーへのアクセス

1. サイドバーから「Orders」をクリック
2. 「カレンダー」タブまたはボタンをクリック

### 表示モードの切り替え

#### 月間表示
- 1ヶ月分の案件を一覧表示
- 日付ごとに案件が表示されます

#### 週間表示
- 1週間分の案件を詳細表示
- より詳しい情報が確認できます

**切り替え方法:**
- 画面右上の「週間表示に切替」または「月間表示に切替」ボタンをクリック

### カレンダーのフィルタリング

1. 「フィルター」ボタンをクリック
2. フィルター条件を指定
   - 企業
   - 飲食店
   - ステータス
3. 「フィルター適用」ボタンをクリック

### 警告アイコンの意味

#### メニュー重複警告（黄色の三角アイコン）
- 同じ週に同じメニューが重複している場合に表示
- アイコンにマウスを合わせると詳細が表示されます

#### コンフリクト警告（赤色の円アイコン）
- スケジュールに問題がある場合に表示
- 時間帯の重複や同日配送複数などを検出

### 案件の詳細確認

- カレンダー上の案件をクリックすると詳細画面に遷移します

---

## スケジュール調整

### スケジュール調整画面へのアクセス

1. サイドバーから「Orders」をクリック
2. 「スケジュール調整」ボタンをクリック

### 期間の指定

1. 画面上部のフィルターを開く
2. 開始日・終了日を入力
3. 「フィルター適用」ボタンをクリック

### 案件の一括更新

1. 更新したい案件のチェックボックスをチェック
   - 全選択する場合は表ヘッダーのチェックボックスをクリック
2. 日付または時刻を直接編集
3. 「選択した案件を更新」ボタンをクリック
4. 確認ダイアログで「OK」をクリック

**注意事項:**
- チェックされた案件のみが更新されます
- バリデーションエラーがある場合はエラーメッセージが表示されます

### コンフリクトの確認

- 赤色の行は何らかのコンフリクトがあることを示します
- 警告列のアイコンにマウスを合わせると詳細が表示されます

**コンフリクトの種類:**
- **時間帯重複**: 同じ飲食店で2時間以内に別の案件がある
- **複数配送**: 同じ企業の同じ日に複数の配送がある

---

## 配送シート出力

### 配送シート画面へのアクセス

1. サイドバーから「Orders」をクリック
2. 「配送シート」ボタンをクリック
   - カレンダー画面からもアクセス可能
   - スケジュール調整画面からもアクセス可能

### フィルタリング

1. 「フィルター」ボタンをクリック
2. フィルター条件を指定
   - **開始日・終了日**: 出力する期間
   - **企業**: 特定の企業のみ
   - **飲食店**: 特定の飲食店のみ
   - **配送会社**: 特定の配送会社のみ
3. 「フィルター適用」ボタンをクリック

### PDF出力

1. フィルター条件を設定
2. 「PDF出力」ボタンをクリック
3. PDFファイルがダウンロードされます

**PDF内容:**
- 日付ごとにグループ化
- 回収時刻、倉庫集荷時刻
- 企業名、飲食店名、メニュー名
- 食数、区分（試食会/本導入）
- 返却先、器材メモ

### プレビュー

- 画面上部にプレビューテーブルが表示されます
- 日付ごとにグループ化されています
- メニュー重複がある場合は警告アイコンが表示されます

---

## 請求書管理

### 請求書一覧の表示

1. サイドバーから「Invoices」をクリック
2. 請求書一覧が表示されます

**表示項目:**
- 請求書番号
- 企業名
- 発行日
- 支払期限
- 請求金額
- ステータス（下書き/送付済み/支払済み）
- 支払状況（未払い/一部入金/完済）

### 請求書の検索・フィルタリング

1. 一覧画面上部の検索ボックスを使用
2. フィルター条件を指定
   - 企業
   - ステータス（draft / sent / paid）
   - 支払状況（unpaid / partial / paid）
   - 発行日範囲
   - 支払期限範囲
3. 「検索」ボタンをクリック

### 月次請求書の自動生成

1. サイドバーから「Invoices」をクリック
2. 「月次請求書生成」ボタンをクリック
3. 生成条件を指定
   - **対象年月**: 請求対象の年月を選択
   - **企業**: 特定企業のみ生成する場合は選択（全企業の場合は未選択）
4. 「生成する」ボタンをクリック

**生成される内容:**
- 指定月の完了済み案件が自動集計
- 請求明細として各案件の情報が含まれる
- 小計、消費税、合計金額が自動計算

**注意事項:**
- 既に請求書が存在する企業・年月の組み合わせは重複生成されません
- 完了済み（completed）ステータスの案件のみが対象
- 案件が0件の企業には請求書は生成されません

### 請求書の手動作成

1. 「新規作成」ボタンをクリック
2. 必要な情報を入力
   - **企業**: 請求先企業を選択
   - **請求書番号**: 自動採番または手動入力
   - **発行日**: 請求書の発行日
   - **支払期限**: 入金期限日
   - **請求期間**: 請求対象期間の開始日・終了日
   - **ステータス**: draft（下書き）/ sent（送付済み）/ paid（支払済み）
   - **支払状況**: unpaid（未払い）/ partial（一部入金）/ paid（完済）
3. 明細を追加
   - 「明細を追加」ボタンをクリック
   - 品目、数量、単価、金額を入力
4. 「作成する」ボタンをクリック

### 請求書の編集

1. 編集したい請求書の「編集」リンクをクリック
2. 情報を修正
3. 明細の追加・編集・削除
4. 「更新する」ボタンをクリック

**注意:** 支払済み（paid）ステータスの請求書は編集できません

### 請求書PDFの出力

1. 請求書詳細画面で「PDF出力」ボタンをクリック
2. PDFファイルがダウンロードされます

**PDF内容:**
- 請求書番号、発行日、支払期限
- 請求先企業情報
- 請求明細（品目、数量、単価、金額）
- 小計、消費税（10%）、合計金額
- 振込先情報
- 備考

### 請求書の送付

1. 請求書詳細画面で「送付」ボタンをクリック
2. 送付先メールアドレスを確認
3. 「送信する」ボタンをクリック
4. ステータスが自動的に「sent（送付済み）」に更新

**送付内容:**
- 請求書PDF（添付ファイル）
- 振込先情報
- 支払期限のリマインド

### 請求書の削除

1. 削除したい請求書の「削除」リンクをクリック
2. 確認ダイアログで「OK」をクリック

**注意:**
- 入金記録が紐付いている請求書は削除できません
- 送付済み・支払済みの請求書は削除前に確認が必要です

---

## 入金管理

### 入金一覧の表示

1. サイドバーから「Payments」をクリック
2. 入金記録一覧が表示されます

**表示項目:**
- 入金日
- 企業名
- 請求書番号
- 入金額
- 入金方法（銀行振込/クレジットカード/現金/その他）
- メモ

### 入金記録の登録

1. 「新規作成」ボタンをクリック
2. 必要な情報を入力
   - **請求書**: 対象請求書を選択
   - **入金日**: 入金が確認された日付
   - **入金額**: 入金された金額
   - **入金方法**: bank_transfer / credit_card / cash / other
   - **メモ**: 振込人名義など追加情報
3. 「作成する」ボタンをクリック

**自動処理:**
- 入金額が請求金額に達すると、請求書の支払状況が自動的に「paid（完済）」に更新
- 一部入金の場合は「partial（一部入金）」に更新
- 請求書のステータスも自動的に「paid（支払済み）」に更新（完済時）

### 入金記録の編集

1. 編集したい入金記録の「編集」リンクをクリック
2. 情報を修正
3. 「更新する」ボタンをクリック

### 入金記録の削除

1. 削除したい入金記録の「削除」リンクをクリック
2. 確認ダイアログで「OK」をクリック

**注意:** 入金記録を削除すると、請求書の支払状況が自動的に再計算されます

### 入金状況の確認

#### 未入金請求書の確認

1. サイドバーから「Invoices」をクリック
2. フィルターで「支払状況: unpaid（未払い）」を選択
3. 支払期限の過ぎた請求書は赤字で表示されます

#### 入金予定の確認

1. サイドバーから「Invoices」をクリック
2. 「支払期限でソート」をクリック
3. 今後の入金予定日順に表示されます

### 未払い請求書の自動チェック

システムが毎日自動的に未払い請求書をチェックし、以下の条件でメール通知を送信します：

**通知条件:**
- 支払期限を7日以上過ぎた未払い請求書
- ステータスが「sent（送付済み）」または「overdue（期限超過）」
- 支払状況が「unpaid（未払い）」または「partial（一部入金）」

**通知内容:**
- 請求書番号
- 企業名
- 請求金額
- 支払期限
- 経過日数

---

## 在庫管理

### 在庫一覧の表示

1. サイドバーから「Supplies」をクリック
2. 在庫一覧が表示されます

**表示項目:**
- 品目名
- カテゴリ（容器/箸/スプーン/フォーク/おしぼり/その他）
- 現在庫数
- 単位（個/セット/箱）
- 最低在庫数
- 在庫ステータス（十分/やや少ない/不足）

### 在庫の新規登録

1. 「新規作成」ボタンをクリック
2. 必要な情報を入力
   - **品目名**: 在庫品の名称
   - **カテゴリ**: container / chopsticks / spoon / fork / hand_towel / other
   - **現在庫数**: 現在の在庫数
   - **単位**: piece（個） / set（セット） / box（箱） / other（その他）
   - **最低在庫数**: アラート表示の基準値
   - **メモ**: サイズ、仕様など追加情報
3. 「作成する」ボタンをクリック

### 在庫数の更新

#### 手動更新

1. 更新したい在庫の「編集」リンクをクリック
2. 現在庫数を修正
3. 「更新する」ボタンをクリック

#### 入出庫記録

1. 在庫詳細画面で「入出庫記録」タブをクリック
2. 「新規記録」ボタンをクリック
3. 記録情報を入力
   - **記録日**: 入出庫日
   - **タイプ**: in（入庫） / out（出庫） / adjustment（調整）
   - **数量**: 入出庫数（出庫の場合はマイナス値）
   - **メモ**: 発注先、使用用途など
4. 「記録する」ボタンをクリック

**自動処理:**
- 入出庫記録を登録すると現在庫数が自動的に増減
- 最低在庫数を下回るとステータスが「不足」に変更

### 在庫アラートの確認

#### ダッシュボード表示

- 管理画面トップに在庫不足アラートが表示されます
- 「不足」ステータスの在庫が赤字で表示

#### 在庫一覧でのフィルタリング

1. サイドバーから「Supplies」をクリック
2. 「在庫ステータス: 不足」でフィルター
3. 発注が必要な在庫のみ表示

### 在庫の削除

1. 削除したい在庫の「削除」リンクをクリック
2. 確認ダイアログで「OK」をクリック

**注意:** 入出庫記録が紐付いている在庫は削除できません

---

## マスタデータ管理

### 企業マスタ

1. サイドバーから「Companies」をクリック
2. 企業の追加・編集・削除が可能

**主要項目:**
- 企業名
- 請求先名
- カラー（カレンダー表示用）
- 配送時刻
- 請求先住所・電話番号

### 飲食店マスタ

1. サイドバーから「Restaurants」をクリック
2. 飲食店の追加・編集・削除が可能

**主要項目:**
- 飲食店名
- 契約ステータス
- キャパシティ（1日あたりの最大食数）
- 最大ロット数（1日あたりの最大案件数）
- 定休日
- 回収時刻
- 住所・連絡先

### メニューマスタ

1. サイドバーから「Menus」をクリック
2. メニューの追加・編集・削除が可能

**主要項目:**
- メニュー名
- 飲食店
- カテゴリ
- 写真

### 配送会社マスタ

1. サイドバーから「Delivery companies」をクリック
2. 配送会社の追加・編集・削除が可能

**主要項目:**
- 配送会社名
- 連絡先
- 配送エリア

---

## トラブルシューティング

### Q1. ログインできない

**原因と対処法:**
1. メールアドレス・パスワードが間違っている
   → パスワードリセット機能を使用
2. アカウントが無効化されている
   → 管理者に連絡

### Q2. 案件を作成できない

**エラーメッセージ別の対処法:**

#### 「この日の合計食数が飲食店のキャパシティを超えています」
- 原因: 飲食店の1日のキャパシティオーバー
- 対処: 日付を変更するか、他の案件を削除/変更

#### 「定休日です」
- 原因: 選択した日付が飲食店の定休日
- 対処: 別の日付を選択

#### 「倉庫集荷から飲食店回収まで最低30分の余裕が必要です」
- 原因: 倉庫集荷時刻と回収時刻の間隔が短すぎる
- 対処: 時刻を調整

### Q3. PDF出力ができない

**原因と対処法:**
1. フィルター条件で案件が0件
   → フィルター条件を緩和
2. ブラウザのポップアップブロック
   → ポップアップを許可
3. 日本語フォントが未設定
   → README.mdの「日本語フォント設定」を参照

### Q4. カレンダーに案件が表示されない

**確認事項:**
1. フィルター条件が厳しすぎないか確認
2. 表示期間内に案件があるか確認
3. ステータスがキャンセル以外か確認

### Q5. 自動生成で案件が作成されない

**確認事項:**
1. 定期スケジュールの期間が正しいか
2. 飲食店の定休日に該当していないか
3. キャパシティオーバーになっていないか
4. 既に同じ案件が存在しないか

### Q6. ページの読み込みが遅い

**対処法:**
1. フィルター条件を狭めて表示件数を減らす
2. ブラウザのキャッシュをクリア
3. 管理者に連絡（データベース最適化が必要な可能性）

### Q7. 請求書PDF出力で文字化けする

**原因と対処法:**
1. 日本語フォントが未設定
   → README.mdの「日本語フォント設定」を参照
2. ブラウザの設定
   → PDFビューアの設定を確認

### Q8. 月次請求書生成で一部の企業が生成されない

**確認事項:**
1. 対象月に完了済み案件があるか確認
2. 既に請求書が存在しないか確認
3. 企業の請求メールアドレスが設定されているか確認

### Q9. 入金を登録したのに請求書のステータスが変わらない

**確認事項:**
1. 入金額の合計が請求金額に達しているか確認
   - 一部入金の場合は「partial（一部入金）」
   - 全額入金の場合は「paid（完済）」
2. 入金記録が正しい請求書に紐付いているか確認

### Q10. 在庫アラートが表示されない

**確認事項:**
1. 最低在庫数が設定されているか確認
2. 現在庫数が最低在庫数を下回っているか確認
3. ダッシュボードの表示設定を確認

---

## お問い合わせ

システムに関するお問い合わせは以下までご連絡ください：

- **開発担当**: Claude
- **GitHub Issues**: https://github.com/anthropics/claude-code/issues
