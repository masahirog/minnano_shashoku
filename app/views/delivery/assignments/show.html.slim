.container.mx-auto.px-4.py-6.max-w-4xl
  / ãƒ˜ãƒƒãƒ€ãƒ¼
  .mb-6
    = link_to delivery_assignments_path, class: "inline-flex items-center text-blue-600 hover:text-blue-800 mb-3" do
      svg.w-5.h-5.mr-1 fill="none" stroke="currentColor" viewBox="0 0 24 24"
        path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"
      | æˆ»ã‚‹
    h1.text-2xl.font-bold.text-gray-800 é…é€è©³ç´°

  / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒŠãƒ¼
  div class="mb-6 p-4 rounded-lg #{case @delivery_assignment.status when 'pending' then 'bg-gray-100 border border-gray-300' when 'preparing' then 'bg-yellow-100 border border-yellow-300' when 'in_transit' then 'bg-blue-100 border border-blue-300' when 'completed' then 'bg-green-100 border border-green-300' when 'failed' then 'bg-red-100 border border-red-300' end}"
    .flex.items-center.justify-between
      .flex.items-center
        span.text-2xl.mr-3
          = case @delivery_assignment.status when 'pending' then 'â¸ï¸' when 'preparing' then 'ğŸ“¦' when 'in_transit' then 'ğŸšš' when 'completed' then 'âœ…' when 'failed' then 'âŒ' end
        div
          p.text-sm.text-gray-600 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
          p class="text-lg font-bold #{case @delivery_assignment.status when 'pending' then 'text-gray-800' when 'preparing' then 'text-yellow-800' when 'in_transit' then 'text-blue-800' when 'completed' then 'text-green-800' when 'failed' then 'text-red-800' end}"
            = case @delivery_assignment.status when 'pending' then 'å¾…æ©Ÿä¸­' when 'preparing' then 'æº–å‚™ä¸­' when 'in_transit' then 'é…é€ä¸­' when 'completed' then 'é…é€å®Œäº†' when 'failed' then 'é…é€å¤±æ•—' end

      - if @delivery_assignment.assigned_at.present?
        .text-right
          p.text-xs.text-gray-600 å‰²å½“æ—¥æ™‚
          p.text-sm.font-semibold.text-gray-700 = @delivery_assignment.assigned_at.strftime('%m/%d %H:%M')

  / é…é€å…ˆæƒ…å ±
  .bg-white.rounded-lg.shadow-md.p-6.mb-6
    h2.text-lg.font-bold.text-gray-800.mb-4.flex.items-center
      svg.w-6.h-6.mr-2.text-blue-600 fill="none" stroke="currentColor" viewBox="0 0 24 24"
        path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
        path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
      | é…é€å…ˆæƒ…å ±

    .space-y-3
      div
        p.text-sm.text-gray-600 ä¼æ¥­å
        p.text-lg.font-semibold.text-gray-900 = @order.company.name

      - if @order.recipient_name.present?
        div
          p.text-sm.text-gray-600 å—å–äºº
          p.font-semibold.text-gray-900 = @order.recipient_name

      div
        p.text-sm.text-gray-600 é…é€å…ˆä½æ‰€
        p.font-semibold.text-gray-900 = @order.delivery_address || @order.company.delivery_address

      - if @order.recipient_phone.present?
        div
          p.text-sm.text-gray-600 é€£çµ¡å…ˆ
          p.font-semibold.text-gray-900
            a.text-blue-600.hover:underline href="tel:#{@order.recipient_phone}"
              = @order.recipient_phone

      .flex.items-center.justify-between.pt-3.border-t
        div
          p.text-sm.text-gray-600 é…é€äºˆå®šæ—¥æ™‚
          p.font-semibold.text-gray-900
            = l(@delivery_assignment.scheduled_date, format: :long)
            - if @delivery_assignment.scheduled_time
              = " "
              = @delivery_assignment.scheduled_time.strftime('%H:%M')
        - if @delivery_assignment.sequence_number.present?
          .text-right
            p.text-sm.text-gray-600 é †åº
            p.text-lg.font-bold.text-gray-900 = @delivery_assignment.sequence_number

      / ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ãƒœã‚¿ãƒ³
      - address = @order.delivery_address || @order.company.delivery_address
      - if address.present?
        .pt-3.border-t
          a.block.w-full.bg-blue-600.text-white.text-center.py-3.rounded-lg.font-semibold.hover:bg-blue-700.transition-colors href="https://www.google.com/maps/dir/?api=1&destination=#{ERB::Util.url_encode(address)}" target="_blank"
            svg.w-5.h-5.inline.mr-2 fill="none" stroke="currentColor" viewBox="0 0 24 24"
              path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"
            | Google Mapsã§é–‹ã

  / å•†å“æƒ…å ±
  .bg-white.rounded-lg.shadow-md.p-6.mb-6
    h2.text-lg.font-bold.text-gray-800.mb-4.flex.items-center
      svg.w-6.h-6.mr-2.text-green-600 fill="none" stroke="currentColor" viewBox="0 0 24 24"
        path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
      | å•†å“æƒ…å ±

    .space-y-3
      - if @order.restaurant.present?
        div
          p.text-sm.text-gray-600 é£²é£Ÿåº—
          p.font-semibold.text-gray-900 = @order.restaurant.name

      - if @order.menu.present?
        div
          p.text-sm.text-gray-600 ãƒ¡ãƒ‹ãƒ¥ãƒ¼
          p.font-semibold.text-gray-900 = @order.menu.name

      div
        p.text-sm.text-gray-600 é£Ÿæ•°
        p.text-2xl.font-bold.text-gray-900
          = @order.confirmed_meal_count || @order.default_meal_count
          | é£Ÿ

      - if @order.collection_time.present?
        div
          p.text-sm.text-gray-600 å›åæ™‚åˆ»
          p.font-semibold.text-gray-900 = @order.collection_time.strftime('%H:%M')

      - if @order.warehouse_pickup_time.present?
        div
          p.text-sm.text-gray-600 å€‰åº«é›†è·æ™‚åˆ»
          p.font-semibold.text-gray-900 = @order.warehouse_pickup_time.strftime('%H:%M')

  / ç‰¹è¨˜äº‹é …
  - if @order.delivery_notes.present? || @order.equipment_notes.present?
    .bg-yellow-50.border.border-yellow-200.rounded-lg.p-6.mb-6
      h2.text-lg.font-bold.text-gray-800.mb-4.flex.items-center
        svg.w-6.h-6.mr-2.text-yellow-600 fill="none" stroke="currentColor" viewBox="0 0 24 24"
          path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
        | ç‰¹è¨˜äº‹é …

      .space-y-3
        - if @order.delivery_notes.present?
          div
            p.text-sm.text-yellow-800.font-semibold é…é€ãƒ¡ãƒ¢
            p.text-gray-900.whitespace-pre-wrap = @order.delivery_notes

        - if @order.equipment_notes.present?
          div
            p.text-sm.text-yellow-800.font-semibold å™¨æãƒ¡ãƒ¢
            p.text-gray-900.whitespace-pre-wrap = @order.equipment_notes

  / ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
  .space-y-3.pb-6
    - case @delivery_assignment.status
    - when 'pending'
      = button_to "ğŸ“¦ æº–å‚™ã‚’é–‹å§‹ã™ã‚‹", update_status_delivery_assignment_path(@delivery_assignment), method: :patch, params: { status: 'preparing' }, data: { confirm: 'é…é€æº–å‚™ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ' }, class: "w-full bg-yellow-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-yellow-700 transition-colors"

    - when 'preparing'
      = button_to "ğŸšš é…é€ã‚’é–‹å§‹ã™ã‚‹", update_status_delivery_assignment_path(@delivery_assignment), method: :patch, params: { status: 'in_transit' }, data: { confirm: 'é…é€ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ' }, class: "w-full bg-blue-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-700 transition-colors"

    - when 'in_transit'
      = link_to "âœ… é…é€å ±å‘Šã‚’ä½œæˆ", new_delivery_assignment_report_path(@delivery_assignment), class: "block w-full text-center bg-green-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-700 transition-colors"

    - when 'completed'
      .text-center.py-8
        svg.w-16.h-16.mx-auto.text-green-600.mb-4 fill="none" stroke="currentColor" viewBox="0 0 24 24"
          path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
        p.text-lg.font-bold.text-gray-800 é…é€ãŒå®Œäº†ã—ã¾ã—ãŸ
        p.text-gray-600.mt-2 ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼

    - when 'failed'
      .text-center.py-8
        svg.w-16.h-16.mx-auto.text-red-600.mb-4 fill="none" stroke="currentColor" viewBox="0 0 24 24"
          path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        p.text-lg.font-bold.text-gray-800 é…é€ãŒå¤±æ•—ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã¾ã™
        p.text-gray-600.mt-2 ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„
