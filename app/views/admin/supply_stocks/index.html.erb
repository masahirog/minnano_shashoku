<% content_for(:title) do %>
  <%= display_resource_name(:supply_stock) %>
<% end %>

<% breadcrumb :admin_supply_stocks %>

<header class="main-content__header" style="display: flex; align-items: center; flex-wrap: wrap;">
  <%= breadcrumbs separator: " ＞ ".html_safe, autoroot: false, class: "breadcrumbs" %>

  <div style="margin-left: auto;">
    <%= link_to(
      "拠点別在庫一覧",
      by_location_admin_supply_stocks_path,
      class: "button",
      style: "background-color: #28a745; color: white; margin-right: 10px;"
    ) %>

    <%= link_to(
      "備品移動登録",
      new_admin_bulk_supply_movement_path,
      class: "button",
      style: "background-color: #007bff; color: white;"
    ) %>
  </div>
</header>

<section class="main-content__body main-content__body--flush">
  <div style="padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin: 20px;">
    <p style="margin: 0; color: #856404;">
      <strong>注意:</strong> 在庫の直接編集はできません。在庫を調整する場合は「備品移動登録」から入荷・消費・移動の操作を行ってください。
    </p>
  </div>

  <table class="table" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="background-color: #f5f5f5;">
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">備品名</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">SKU</th>
        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">カテゴリ</th>
        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">合計在庫数</th>
        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">拠点数</th>
        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">操作</th>
      </tr>
    </thead>
    <tbody>
      <% Supply.includes(:supply_stocks).order(:name).each do |supply| %>
        <tr style="border-bottom: 1px solid #eee;">
          <td style="padding: 12px;"><%= supply.name %></td>
          <td style="padding: 12px;"><%= supply.sku %></td>
          <td style="padding: 12px;"><%= supply.category %></td>
          <td style="padding: 12px; text-align: right; font-weight: bold;">
            <%= supply.supply_stocks.sum(:quantity) %> <%= supply.unit %>
          </td>
          <td style="padding: 12px; text-align: center;">
            <%= supply.supply_stocks.count %>拠点
          </td>
          <td style="padding: 12px; text-align: center;">
            <%= link_to(
              "拠点別詳細",
              by_location_admin_supply_stocks_path(supply_id: supply.id),
              class: "button",
              style: "font-size: 12px; padding: 6px 12px;"
            ) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</section>
